[
    {
        "cve_id": "CVE-2018-10932",
        "func_name": "intel/openlldp/print_mng_addr",
        "description": "lldptool version 1.0.1 and older can print a raw, unsanitized attacker controlled buffer when mngAddr information is displayed. This may allow an attacker to inject shell control characters into the buffer and impact the behavior of the terminal.",
        "git_url": "https://github.com/intel/openlldp/commit/cf3f54d1883e5bc23e4c4006a63e1dde88684013",
        "commit_title": "basman_clif: print the OID properly",
        "commit_text": " When invoking the lldp tool to view the management information, the display for the OID is printed as the actual binary bits, rather than the OID dotted-notation form.  This change will display the OID as expected. ",
        "func_before": "void print_mng_addr(u16 len, char *info)\n{\n\tu8 addrlen;\n\tu8 addrnum;\n\tu8 iftype;\n\tu8 oidlen;\n\tu32 ifnum;\n\tu32 offset;\n\tint i;\n\tchar buf[132];\n\n\tif (len < 9 || len > 167) {\n\t\tprintf(\"Bad Management Address TLV: %*.*s\\n\",\n\t\t\t2*len, 2*len, info);\n\t\treturn;\n\t}\n\n\thexstr2bin(info, (u8 *)&addrlen, sizeof(addrlen));\n\thexstr2bin(info+2, (u8 *)&addrnum, sizeof(addrnum));\n\n\tswitch(addrnum) {\n\tcase MANADDR_ALL802:\n\t\tif (addrlen != 1 + 6)\n\t\t\treturn;\n\t\tprintf(\"MAC: \");\n\t\tfor (i = 0; i < 12; i+=2) {\n\t\t\tprintf(\"%2.2s\", info + 4 + i);\n\t\t\tif (i < 10)\n\t\t\t\tprintf(\":\");\n\t\t\telse\n\t\t\t\tprintf(\"\\n\");\n\t\t}\n\t\tbreak;\n\tcase MANADDR_IPV4:\n\t\tif (addrlen == 5) {\n\t\t\tstruct in_addr addr;\n\t\t\thexstr2bin(info+4, (u8 *)&addr, sizeof(addr));\n\t\t\tinet_ntop(AF_INET, (void *)&addr, buf,\n\t\t\t\t  sizeof(buf));\n\t\t\tprintf(\"IPv4: %s\\n\", buf);\n\t\t} else {\n\t\t\tprintf(\"Bad IPv4: %*.*s\\n\",\n\t\t\t       2*(addrlen-2), 2*(addrlen-2), info+4);\n\t\t}\n\t\tbreak;\n\tcase MANADDR_IPV6:\n\t\tif (addrlen == 17) {\n\t\t\tstruct in6_addr addr;\n\t\t\thexstr2bin(info+4, (u8 *)&addr, sizeof(addr));\n\t\t\tmemset(buf, 0, sizeof(buf));\n\t\t\tinet_ntop(AF_INET6, (void *)&addr, buf,\n\t\t\t\t  sizeof(buf));\n\t\t\tprintf(\"IPv6: %s\\n\", buf);\n\t\t} else {\n\t\t\tprintf(\"Bad IPv6: %*.*s\\n\",\n\t\t\t       2*(addrlen-2), 2*(addrlen-2), info+4);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tprintf(\"Network Address Type %d: %*.*s\\n\", addrnum,\n\t\t       2*(addrlen-1), 2*(addrlen-1), info+4);\n\t\tbreak;\n\t}\n\n\toffset = 2*(1+addrlen);\n\thexstr2bin(info+offset, (u8 *)&iftype, sizeof(iftype));\n\toffset += 2;\n\thexstr2bin(info+offset, (u8 *)&ifnum, sizeof(ifnum));\n\toffset += 2*sizeof(u32);\n\tifnum = ntohl(ifnum);\n\n\tswitch (iftype) {\n\tcase IFNUM_UNKNOWN:\n\t\tprintf(\"\\tUnknown interface subtype: \");\n\t\tbreak;\n\tcase IFNUM_IFINDEX:\n\t\tprintf(\"\\tIfindex: \");\n\t\tbreak;\n\tcase IFNUM_SYS_PORT_NUM:\n\t\tprintf(\"\\tSystem port number: \");\n\t\tbreak;\n\tdefault:\n\t\tprintf(\"\\tBad interface numbering subtype: \");\n\t\tbreak;\n\t}\n\tprintf(\"%d\\n\", ifnum);\n\n\thexstr2bin(info+offset, (u8 *)&oidlen, sizeof(oidlen));\n\toffset += 2;\n\n\tif (oidlen && oidlen <= 128) {\n\t\tmemset(buf, 0, sizeof(buf));\n\t\tif (hexstr2bin(info+offset, (u8 *)&buf, oidlen))\n\t\t\tprintf(\"\\tOID: Error parsing OID\\n\");\n\t\telse\n\t\t\tprintf(\"\\tOID: %s\\n\", buf);\n\t} else if (oidlen > 128) {\n\t\tprintf(\"\\tOID: Invalid length = %d\\n\", oidlen);\n\t}\n}",
        "func": "void print_mng_addr(u16 len, char *info)\n{\n\tu8 addrlen;\n\tu8 addrnum;\n\tu8 iftype;\n\tu8 oidlen;\n\tu32 ifnum;\n\tu32 offset;\n\tint i;\n\tchar buf[132];\n\n\tif (len < 9 || len > 167) {\n\t\tprintf(\"Bad Management Address TLV: %*.*s\\n\",\n\t\t\t2*len, 2*len, info);\n\t\treturn;\n\t}\n\n\thexstr2bin(info, (u8 *)&addrlen, sizeof(addrlen));\n\thexstr2bin(info+2, (u8 *)&addrnum, sizeof(addrnum));\n\n\tswitch(addrnum) {\n\tcase MANADDR_ALL802:\n\t\tif (addrlen != 1 + 6)\n\t\t\treturn;\n\t\tprintf(\"MAC: \");\n\t\tfor (i = 0; i < 12; i+=2) {\n\t\t\tprintf(\"%2.2s\", info + 4 + i);\n\t\t\tif (i < 10)\n\t\t\t\tprintf(\":\");\n\t\t\telse\n\t\t\t\tprintf(\"\\n\");\n\t\t}\n\t\tbreak;\n\tcase MANADDR_IPV4:\n\t\tif (addrlen == 5) {\n\t\t\tstruct in_addr addr;\n\t\t\thexstr2bin(info+4, (u8 *)&addr, sizeof(addr));\n\t\t\tinet_ntop(AF_INET, (void *)&addr, buf,\n\t\t\t\t  sizeof(buf));\n\t\t\tprintf(\"IPv4: %s\\n\", buf);\n\t\t} else {\n\t\t\tprintf(\"Bad IPv4: %*.*s\\n\",\n\t\t\t       2*(addrlen-2), 2*(addrlen-2), info+4);\n\t\t}\n\t\tbreak;\n\tcase MANADDR_IPV6:\n\t\tif (addrlen == 17) {\n\t\t\tstruct in6_addr addr;\n\t\t\thexstr2bin(info+4, (u8 *)&addr, sizeof(addr));\n\t\t\tmemset(buf, 0, sizeof(buf));\n\t\t\tinet_ntop(AF_INET6, (void *)&addr, buf,\n\t\t\t\t  sizeof(buf));\n\t\t\tprintf(\"IPv6: %s\\n\", buf);\n\t\t} else {\n\t\t\tprintf(\"Bad IPv6: %*.*s\\n\",\n\t\t\t       2*(addrlen-2), 2*(addrlen-2), info+4);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tprintf(\"Network Address Type %d: %*.*s\\n\", addrnum,\n\t\t       2*(addrlen-1), 2*(addrlen-1), info+4);\n\t\tbreak;\n\t}\n\n\toffset = 2*(1+addrlen);\n\thexstr2bin(info+offset, (u8 *)&iftype, sizeof(iftype));\n\toffset += 2;\n\thexstr2bin(info+offset, (u8 *)&ifnum, sizeof(ifnum));\n\toffset += 2*sizeof(u32);\n\tifnum = ntohl(ifnum);\n\n\tswitch (iftype) {\n\tcase IFNUM_UNKNOWN:\n\t\tprintf(\"\\tUnknown interface subtype: \");\n\t\tbreak;\n\tcase IFNUM_IFINDEX:\n\t\tprintf(\"\\tIfindex: \");\n\t\tbreak;\n\tcase IFNUM_SYS_PORT_NUM:\n\t\tprintf(\"\\tSystem port number: \");\n\t\tbreak;\n\tdefault:\n\t\tprintf(\"\\tBad interface numbering subtype: \");\n\t\tbreak;\n\t}\n\tprintf(\"%d\\n\", ifnum);\n\n\thexstr2bin(info+offset, (u8 *)&oidlen, sizeof(oidlen));\n\toffset += 2;\n\n\tif (oidlen && oidlen <= 128) {\n\t\tmemset(buf, 0, sizeof(buf));\n\t\tif (hexstr2bin(info+offset, (u8 *)&buf, oidlen))\n\t\t\tprintf(\"\\tOID: Error parsing OID\\n\");\n\t\telse {\n\t\t\tprintf(\"\\tOID: 0.\");\n\t\t\tfor (i = 0; i < oidlen; ++i) {\n\t\t\t\tprintf(\"%d\", buf[i]);\n\t\t\t\tif (i != (oidlen - 1))\n\t\t\t\t\tprintf(\".\");\n\t\t\t}\n\t\t\tprintf(\"\\n\");\n\t\t}\n\t} else if (oidlen > 128) {\n\t\tprintf(\"\\tOID: Invalid length = %d\\n\", oidlen);\n\t}\n}",
        "diff_func": "--- func_before\n+++ func_after\n@@ -92,8 +92,15 @@\n \t\tmemset(buf, 0, sizeof(buf));\n \t\tif (hexstr2bin(info+offset, (u8 *)&buf, oidlen))\n \t\t\tprintf(\"\\tOID: Error parsing OID\\n\");\n-\t\telse\n-\t\t\tprintf(\"\\tOID: %s\\n\", buf);\n+\t\telse {\n+\t\t\tprintf(\"\\tOID: 0.\");\n+\t\t\tfor (i = 0; i < oidlen; ++i) {\n+\t\t\t\tprintf(\"%d\", buf[i]);\n+\t\t\t\tif (i != (oidlen - 1))\n+\t\t\t\t\tprintf(\".\");\n+\t\t\t}\n+\t\t\tprintf(\"\\n\");\n+\t\t}\n \t} else if (oidlen > 128) {\n \t\tprintf(\"\\tOID: Invalid length = %d\\n\", oidlen);\n \t}",
        "diff_line_info": {
            "deleted_lines": [
                "\t\telse",
                "\t\t\tprintf(\"\\tOID: %s\\n\", buf);"
            ],
            "added_lines": [
                "\t\telse {",
                "\t\t\tprintf(\"\\tOID: 0.\");",
                "\t\t\tfor (i = 0; i < oidlen; ++i) {",
                "\t\t\t\tprintf(\"%d\", buf[i]);",
                "\t\t\t\tif (i != (oidlen - 1))",
                "\t\t\t\t\tprintf(\".\");",
                "\t\t\t}",
                "\t\t\tprintf(\"\\n\");",
                "\t\t}"
            ]
        }
    }
]